<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jersey Roots | v22.6 (Stable Snow Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a; 
            background-image: linear-gradient(rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.98)), url("https://www.transparenttextures.com/patterns/diagmonds-light.png");
            color: #cbd5e1;
        }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .glass-panel { background: rgba(30, 41, 59, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2); }
        .btn-primary { background: linear-gradient(to bottom, #16a34a, #15803d); border: 1px solid #166534; transition: all 0.2s; }
        .btn-primary:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-blue { background: linear-gradient(to bottom, #2563eb, #1d4ed8); border: 1px solid #1e40af; transition: all 0.2s; }
        .btn-blue:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .progress-bar { transition: width 1s linear; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        
        .fuel-flow {
            background: linear-gradient(45deg, #ea580c 25%, #c2410c 25%, #c2410c 50%, #ea580c 50%, #ea580c 75%, #c2410c 75%, #c2410c);
            background-size: 20px 20px;
            animation: flow 1s linear infinite;
        }
        .snow-bg { background-color: #e2e8f0; background-image: url("https://www.transparenttextures.com/patterns/snow.png"); color: #1e293b; }
        .snow-bg .glass-panel { background: rgba(255, 255, 255, 0.85); border: 1px solid rgba(0,0,0,0.1); color: #0f172a; }
        .snow-bg .text-slate-400 { color: #64748b; }
        .snow-bg .text-white { color: #0f172a; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS ---
        const IconWrapper = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        const Icons = {
            Tractor: ({className}) => <IconWrapper className={className}><path d="M3 4h9l1 7h5.42A2.58 2.58 0 0 1 21 13.58v.57L16.85 18H12v-6H8v6H4.5A1.5 1.5 0 0 1 3 16.5V4z"/><circle cx="7" cy="18" r="2"/><circle cx="18" cy="18" r="2"/></IconWrapper>,
            Barn: ({className}) => <IconWrapper className={className}><path d="M22 22H2V10l10-8 10 8v12zM12 14v8M12 2v3"/><rect x="6" y="12" width="4" height="4"/><rect x="14" y="12" width="4" height="4"/></IconWrapper>,
            Silo: ({className}) => <IconWrapper className={className}><path d="M2 22v-5l5-5 5 5-5 5z"/><path d="M12 2v20"/><path d="M7 12h10"/></IconWrapper>,
            Users: ({className}) => <IconWrapper className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconWrapper>,
            Fuel: ({className}) => <IconWrapper className={className}><path d="M6 22q2-2 2-8c0-3.6-1.5-5-2-5s-2 1.4-2 5q0 6 2 8"/><path d="M12 22a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z"/><path d="M12 2v2"/><path d="M12 22v-2"/></IconWrapper>,
            Truck: ({className}) => <IconWrapper className={className}><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></IconWrapper>,
            Hammer: ({className}) => <IconWrapper className={className}><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25V2.75A2.75 2.75 0 0 0 16 0h-2.54a1 1 0 0 0-.76.35L1.08 13.08c-.6.6-.93 1.4-.93-2.25V2.75"/></IconWrapper>,
            Clock: ({className}) => <IconWrapper className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconWrapper>,
            Box: ({className}) => <IconWrapper className={className}><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22v-9"/></IconWrapper>,
            Bank: ({className}) => <IconWrapper className={className}><rect x="3" y="18" width="18" height="4" rx="1"/><rect x="3" y="3" width="18" height="4" rx="1"/><path d="M4 7v11"/><path d="M20 7v11"/><path d="M12 7v11"/><path d="M8 7v11"/><path d="M16 7v11"/></IconWrapper>,
            Wrench: ({className}) => <IconWrapper className={className}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></IconWrapper>,
            Snow: ({className}) => <IconWrapper className={className}><path d="M2.5 2.5a.5.5 0 0 1 0 1 .5.5 0 0 1 0-1Zm19 0a.5.5 0 0 1 0 1 .5.5 0 0 1 0-1Zm-9.5 2a.5.5 0 0 1 0 1 .5.5 0 0 1 0-1Zm9.5 17a.5.5 0 0 1 0 1 .5.5 0 0 1 0-1Zm-19 0a.5.5 0 0 1 0 1 .5.5 0 0 1 0-1Z"/><path d="M12 2v20M2 12h20M4.93 4.93l14.14 14.14M4.93 19.07 19.07 4.93"/></IconWrapper>
        };

        const DAY_MS = 86400000;
        const HOUR_MS = 3600000;

        const SERVICE_INTERVAL = 24; 
        const SERVICE_COST = 1200; 
        const REPAIR_COST = 8500; 
        const WEAR_RATE = 2.0; 
        const OVERDUE_RATE = 6.0;
        const FUEL_PRICE = 3.65;
        const LAND_PRICE_PER_ACRE = 16500;
        const SNOW_JOB_TIME = 2 * HOUR_MS; // 2 Hours

        const MONTH_NAMES = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

        // DATA
        const CROPS = { 'Corn': { name: 'Corn', plantMonths: [4, 5], steps: ['Primary Tillage', 'Lime', 'Fertilizer', 'Secondary Tillage', 'Plant', 'Harvest'], inputs: {seed:'seed_corn',seedRate:0.4,fert:0.2,lime:1}, equip:['Planter','Header_Corn'], yield:180, price:4.25 }, 'Soy': { name: 'Soy', plantMonths: [4, 6], steps: ['Primary Tillage', 'Lime', 'Secondary Tillage', 'Plant', 'Spray', 'Harvest'], inputs: {seed:'seed_soy',seedRate:1.0,fert:0,lime:0.5}, equip:['Planter','Header_Grain'], yield:55, price:11.40 }, 'Wheat': { name: 'Wheat', plantMonths: [8, 11], steps: ['Primary Tillage', 'Fertilizer', 'Secondary Tillage', 'Plant', 'Harvest'], inputs: {seed:'seed_wheat',seedRate:2.0,fert:0.15,lime:0}, equip:['Drill','Header_Grain'], yield:85, price:5.60, byproduct:'straw', byYield:1.5 }, 'Hay': { name: 'Alfalfa', plantMonths: [3, 8], steps: ['Primary Tillage', 'Lime', 'Secondary Tillage', 'Plant', 'Cut', 'Tedder', 'Bale'], inputs: {seed:'seed_hay',seedRate:0.5,fert:0.1,lime:1.5}, equip:['Drill','Mower','Baler'], yield:6, price:180 }, 'Cotton': { name: 'Cotton', plantMonths: [4, 5], steps: ['Primary Tillage', 'Fertilizer', 'Secondary Tillage', 'Plant', 'Spray', 'Harvest'], inputs: { seed: 'seed_cotton', seedRate: 0.2, fert: 0.25, lime:1 }, equip: ['Planter', 'Harvester_Cotton'], yield: 3, price: 85.00 }, 'Rice': { name: 'Rice', plantMonths: [3, 5], steps: ['Primary Tillage', 'Fertilizer', 'Plant', 'Spray', 'Harvest'], inputs: { seed: 'seed_rice', seedRate: 1.5, fert: 0.4, lime:0 }, equip: ['Drill', 'Header_Grain'], yield: 160, price: 6.80 }, 'Potato': { name: 'Potatoes', plantMonths: [3, 4], steps: ['Primary Tillage', 'De-Stone', 'Plant', 'Hilling', 'Spray', 'Harvest'], inputs: {seed:'seed_potato',seedRate:20,fert:0.5,lime:0}, equip:['Planter_Potato','Harvester_Potato'], yield:450, price:9.50 }, 'Peanuts': { name: 'Peanuts', plantMonths: [4, 5], steps: ['Tillage', 'Lime', 'Plant', 'Digging', 'Harvest'], inputs: {seed:'seed_peanut',seedRate:1,fert:0.2,lime:0.8}, equip:['Planter','Harvester_Peanut'], yield:4000, price:0.25 }, 'Beets': { name: 'Sugar Beets', plantMonths: [3, 4], steps: ['Tillage', 'Fertilizer', 'Plant', 'Harvest'], inputs: {seed:'seed_beet',seedRate:0.5,fert:0.4,lime:1}, equip:['Planter','Harvester_Beet'], yield:30, price:45.00 }, 'Canola': { name: 'Canola', plantMonths: [7, 8], steps: ['Tillage', 'Fertilizer', 'Plant', 'Harvest'], inputs: {seed:'seed_canola',seedRate:0.3,fert:0.3,lime:0.5}, equip:['Drill','Header_Grain'], yield:45, price:13.50 }, 'Oats': { name: 'Oats', plantMonths: [2, 3], steps: ['Tillage', 'Plant', 'Harvest'], inputs: {seed:'seed_oats',seedRate:3,fert:0.1,lime:0}, equip:['Drill','Header_Grain'], yield:90, price:3.80 }, 'Barley': { name: 'Barley', plantMonths: [8, 10], steps: ['Tillage', 'Plant', 'Harvest'], inputs: {seed:'seed_barley',seedRate:2.5,fert:0.15,lime:0}, equip:['Drill','Header_Grain'], yield:80, price:5.10 }, 'Sorghum': { name: 'Sorghum', plantMonths: [4, 6], steps: ['Tillage', 'Fertilizer', 'Plant', 'Harvest'], inputs: {seed:'seed_sorghum',seedRate:0.4,fert:0.2,lime:0}, equip:['Planter','Header_Grain'], yield:110, price:6.20 }, 'Sunflower': { name: 'Sunflower', plantMonths: [4, 6], steps: ['Tillage', 'Plant', 'Harvest'], inputs: {seed:'seed_sunflower',seedRate:0.3,fert:0.2,lime:0}, equip:['Planter','Header_Sunflower'], yield:1800, price:0.22 } };
        const BUILDINGS = { 'shed_s': { name: 'Small Machine Shed', cost: 65000, category: 'Storage', capacity: 5, buildTime: 14 * DAY_MS }, 'shed_l': { name: 'Large Machine Shed', cost: 150000, category: 'Storage', capacity: 15, buildTime: 30 * DAY_MS }, 'bin_s': { name: 'Grain Bin (10k bu)', cost: 45000, category: 'Storage', capacity: 10000, buildTime: 5 * DAY_MS }, 'bin_l': { name: 'Grain Bin (50k bu)', cost: 110000, category: 'Storage', capacity: 50000, buildTime: 14 * DAY_MS }, 'fuel_s': { name: 'Farm Fuel Tank (1k gal)', cost: 12500, category: 'Infrastructure', capacity: 1000, buildTime: 2 * DAY_MS }, 'fuel_l': { name: 'Fuel Depot (5k gal)', cost: 35000, category: 'Infrastructure', capacity: 5000, buildTime: 7 * DAY_MS }, 'barn': { name: 'Dairy Barn', cost: 450000, capacity: 200, category: 'Livestock', type: 'Livestock_Dairy', input: 'tmr', output: 'milk', buildTime: 90 * DAY_MS }, 'feedlot': { name: 'Beef Feedlot', cost: 120000, capacity: 100, category: 'Livestock', type: 'Livestock_Beef', input: 'corn', output: 'manure', buildTime: 45 * DAY_MS }, 'hog': { name: 'Hog Barn', cost: 250000, capacity: 1000, category: 'Livestock', type: 'Livestock_Hog', input: 'corn', output: 'manure', buildTime: 60 * DAY_MS }, 'coop': { name: 'Chicken Coop', cost: 85000, capacity: 5000, category: 'Livestock', type: 'Livestock_Poultry', input: 'wheat', output: 'eggs', buildTime: 30 * DAY_MS }, 'pasture': { name: 'Sheep Pasture', cost: 25000, capacity: 100, category: 'Livestock', type: 'Livestock_Sheep', input: 'hay', output: 'wool', buildTime: 7 * DAY_MS } };
        const ANIMALS = { 'cow': { name: 'Holstein', cost: 1800, building: 'Livestock_Dairy', dailyFeed: 50, dailyWater: 30, dailyStraw: 10, productRate: 0.8 }, 'steer': { name: 'Angus', cost: 1100, building: 'Livestock_Beef', dailyFeed: 40, dailyWater: 25, dailyStraw: 8 }, 'pig': { name: 'Hog', cost: 150, building: 'Livestock_Hog', dailyFeed: 6, dailyWater: 4, dailyStraw: 1 }, 'hen': { name: 'Hen', cost: 5, building: 'Livestock_Poultry', dailyFeed: 0.25, dailyWater: 0.1, dailyStraw: 0, productRate: 0.9 }, 'sheep': { name: 'Sheep', cost: 250, building: 'Livestock_Sheep', dailyFeed: 4, dailyWater: 2, dailyStraw: 1, productRate: 0.05 } };
        const EQUIPMENT = [ { id: 'jd_8r', name: 'JD 8R 340', cost: 410000, cat: 'Tractor' }, { id: 'cih_mag', name: 'Case IH 310', cost: 385000, cat: 'Tractor' }, { id: 'cih_rip', name: 'Ripper 875', cost: 95000, cat: 'Plow' }, { id: 'jd_vt', name: 'Vertical Till', cost: 125000, cat: 'Cultivator' }, { id: 'jd_plnt', name: 'JD 1775NT', cost: 215000, cat: 'Planter' }, { id: 'gp_drl', name: 'Grain Drill', cost: 85000, cat: 'Drill' }, { id: 'pot_plnt', name: 'Potato Planter', cost: 65000, cat: 'Planter_Potato' }, { id: 'jd_x9', name: 'JD X9 Combine', cost: 850000, cat: 'Combine' }, { id: 'cot_pick', name: 'Cotton Picker', cost: 950000, cat: 'Harvester_Cotton' }, { id: 'pot_harv', name: 'Potato Harv', cost: 450000, cat: 'Harvester_Potato' }, { id: 'beet_harv', name: 'Beet Harv', cost: 650000, cat: 'Harvester_Beet' }, { id: 'pnut_harv', name: 'Peanut Harv', cost: 180000, cat: 'Harvester_Peanut' }, { id: 'hd_corn', name: 'Corn Header', cost: 95000, cat: 'Header_Corn' }, { id: 'hd_grain', name: 'Draper Header', cost: 110000, cat: 'Header_Grain' }, { id: 'hd_sun', name: 'Sun Header', cost: 65000, cat: 'Header_Sunflower' }, { id: 'mix', name: 'TMR Mixer', cost: 85000, cat: 'Mixer' }, { id: 'tank', name: 'Water Tanker', cost: 25000, cat: 'Tanker' }, { id: 'proc', name: 'Bale Proc', cost: 45000, cat: 'Processor' }, { id: 'destone', name: 'De-Stoner', cost: 85000, cat: 'De-Stone' }, { id: 'dig', name: 'Peanut Digger', cost: 45000, cat: 'Digger_Peanut' }, { id: 'mow', name: 'Mower', cost: 55000, cat: 'Mower' }, { id: 'bale', name: 'Baler', cost: 165000, cat: 'Baler' }, { id: 'sprd', name: 'Spreader', cost: 45000, cat: 'Spreader' }, { id: 'spry', name: 'Sprayer', cost: 499000, cat: 'Sprayer' }, { id: 'plow_snow', name: 'Snow Plow', cost: 12000, cat: 'Snow Plow' }, { id: 'salt_sprd', name: 'Salt Spreader', cost: 8500, cat: 'Salt Spreader' } ];
        const SUPPLIES = { 'seed_corn': 320, 'seed_soy': 74, 'seed_wheat': 28, 'seed_hay': 210, 'seed_cotton': 650, 'seed_rice': 35, 'seed_potato': 18, 'seed_beet': 180, 'seed_canola': 450, 'seed_sunflower': 280, 'seed_oats': 18, 'seed_barley': 22, 'seed_sorghum': 150, 'seed_peanut': 90, 'fert': 750, 'lime': 45, 'tmr': 250, 'straw': 100, 'salt': 80 };
        const EMP_ROLES = { 'Hand': { name: 'Farm Hand', wage: 20, desc: 'Field Operations' }, 'Herd': { name: 'Herdsman', wage: 25, desc: 'Livestock Care' }, 'Mech': { name: 'Mechanic', wage: 35, desc: 'Maintenance' }, 'Vet': { name: 'Vet Specialist', wage: 60, desc: 'Animal Health' } };
        const EMP_NAMES = ['John D.', 'Sarah C.', 'Mike R.', 'Emily W.', 'David B.', 'Jess M.', 'Alex P.', 'Sam T.'];

        function App() {
            // --- STATE ---
            const [gameState, setGameState] = useState(() => {
                try {
                    const saved = localStorage.getItem('jersey_roots_v22_6_STABLE'); // FRESH SAVE
                    if(saved) return JSON.parse(saved);
                } catch(e) { console.log("Save error"); }
                
                return {
                    money: 6000000, 
                    loan: 0, 
                    inventory: [], 
                    activeJobs: [], 
                    construction: [], 
                    deliveries: [],
                    transactions: [],
                    employees: [{id:1, name:'Owner', hourlyRate:0, role:'Owner', status:'Idle'}],
                    lastPayroll: null,
                    facilities: [
                        {id:'start', key:'shed_s', type:'Storage', category:'Storage', animals:null},
                        {id:'fuelstart', key:'fuel_s', type:'Infrastructure', category:'Infrastructure', animals:null}
                    ],
                    consumables: { 'diesel': 500 }, 
                    fields: Array.from({length: 50}, (_, i) => ({ id:i+1, owned: i<3, acres: Math.floor(Math.random()*300)+50, state: 'Fallow', cropPlan: null })),
                    weather: 'Clear',
                    snowLevel: 0
                };
            });

            const [now, setNow] = useState(Date.now());
            const [view, setView] = useState('dashboard');
            const [modal, setModal] = useState(null);
            const [storeTab, setStoreTab] = useState('eq');

            // WEATHER API
            useEffect(() => {
                const fetchWeather = async () => {
                    try {
                        const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=40.05&longitude=-74.40&current=weather_code,temperature_2m&timezone=America%2FNew_York');
                        const data = await res.json();
                        if(data && data.current && typeof data.current.weather_code === 'number') {
                            const code = data.current.weather_code;
                            let w = 'Clear';
                            if([71,73,75,77,85,86].includes(code)) w = 'Snow';
                            else if([51,53,55,61,63,65,80,81,82].includes(code)) w = 'Rain';
                            
                            setGameState(prev => {
                                let newSnow = (prev.snowLevel || 0);
                                if(w === 'Snow') newSnow = Math.min(100, newSnow + 5); 
                                else if(w === 'Rain') newSnow = Math.max(0, newSnow - 10); 
                                else if(data.current.temperature_2m > 0) newSnow = Math.max(0, newSnow - 1); 
                                return { ...prev, weather: w, snowLevel: newSnow };
                            });
                        }
                    } catch(e) { console.log("Weather API Error (ignoring)"); }
                };
                fetchWeather();
                const wInterval = setInterval(fetchWeather, 900000);
                return () => clearInterval(wInterval);
            }, []);

            useEffect(() => {
                const t = setInterval(() => {
                    const ct = Date.now();
                    const currentDate = new Date(ct);
                    setNow(ct);
                    
                    setGameState(prev => {
                        let { money, loan, activeJobs, facilities, consumables, employees, fields, deliveries, inventory, construction, lastPayroll, transactions, snowLevel, weather } = prev;
                        
                        // SAFE ARRAY DEFAULTS
                        activeJobs = activeJobs || [];
                        facilities = facilities || [];
                        employees = employees || [];
                        inventory = inventory || [];
                        construction = construction || [];
                        deliveries = deliveries || [];
                        transactions = transactions || [];

                        // PAYROLL
                        const dateString = currentDate.toLocaleDateString();
                        const dayOfWeek = currentDate.getDay(); 
                        if(dayOfWeek === 5 && lastPayroll !== dateString) {
                            let totalPayroll = 0;
                            employees.forEach(e => {
                                if(e.id !== 1) totalPayroll += (e.hourlyRate * 40) + (e.hourlyRate * 1.5 * 10);
                            });
                            if(totalPayroll > 0) {
                                if(money >= totalPayroll) { 
                                    money -= totalPayroll; 
                                    transactions = [{id: Date.now(), desc: `Payroll`, amount: -totalPayroll, date: ct}, ...transactions].slice(0, 50);
                                } else { 
                                    const deficit = totalPayroll - money; money = 0; loan += deficit; 
                                    transactions = [{id: Date.now(), desc: `Payroll Loan`, amount: -totalPayroll, date: ct}, ...transactions].slice(0, 50);
                                }
                                lastPayroll = dateString; 
                            }
                        }

                        if(loan > 0 && Math.random() > 0.999) { loan += loan * 0.001; }

                        let jobs = [], finished = [], jobMoney = 0;

                        // CONSTRUCTION
                        const finConst = construction.filter(c => ct >= c.endTime);
                        finConst.forEach(c => {
                            const def = BUILDINGS[c.key];
                            facilities.push({ id: c.id, key: c.key, type: def.type, category: def.category, animals: null, feed:0, water:0, straw:0, manure:0, output:0 });
                        });
                        const pendingConst = construction.filter(c => ct < c.endTime);

                        // DELIVERIES
                        const arrivedDel = deliveries.filter(d => ct >= d.at);
                        arrivedDel.forEach(d => {
                            if(d.type === 'eq') inventory.push({uid:Math.random().toString(36).substr(2,9), itemId:d.id, fuel: 100, hours:0, condition:100, lastService:0});
                            else if(d.type === 'anim') facilities = facilities.map(f => f.id === d.targetId ? { ...f, animals: { type: f.animals ? f.animals.type : d.id, count: (f.animals ? f.animals.count : 0) + d.qty } } : f);
                            else consumables[d.id] = (consumables[d.id]||0) + d.qty;
                        });
                        const pendingDel = deliveries.filter(d => ct < d.at);

                        // JOBS
                        activeJobs.forEach(j => {
                            if(ct - j.start >= j.dur) { finished.push(j); } 
                            else { 
                                jobs.push(j);
                                j.res.forEach(resId => {
                                    inventory = inventory.map(item => {
                                        if(item.uid === resId && item.hours !== undefined) {
                                            const addedHours = 1/60; 
                                            const newHours = (item.hours || 0) + addedHours;
                                            const hoursSinceService = newHours - (item.lastService || 0);
                                            const rate = hoursSinceService > SERVICE_INTERVAL ? OVERDUE_RATE : WEAR_RATE;
                                            const newCond = Math.max(0, (item.condition || 100) - (rate * addedHours * 0.01));
                                            return { ...item, hours: newHours, condition: newCond };
                                        }
                                        return item;
                                    });
                                });
                            }
                        });

                        finished.forEach(j => {
                            employees = employees.map(e => e.id === j.emp ? {...e, status:'Idle'} : e);
                            if(j.type === 'maintenance') inventory = inventory.map(i => i.uid === j.tid ? { ...i, condition: 100, lastService: i.hours } : i);
                            if(j.type === 'snow') snowLevel = 0; 
                            if(j.type === 'field') {
                                fields = fields.map(f => {
                                    if(f.id === j.tid) {
                                        if(j.step === 'Harvest') {
                                            const crop = CROPS[f.cropPlan.key];
                                            const yieldAmt = f.acres * crop.yield;
                                            consumables[f.cropPlan.key.toLowerCase()] = (consumables[f.cropPlan.key.toLowerCase()]||0) + yieldAmt;
                                            return { ...f, state: 'Stubble', cropPlan: null };
                                        }
                                        const ni = f.cropPlan.idx + 1;
                                        return { ...f, state: CROPS[f.cropPlan.key].steps[ni]||'Growing', cropPlan: {...f.cropPlan, idx: ni} };
                                    }
                                    return f;
                                });
                            }
                            if(j.type === 'chore') {
                                facilities = facilities.map(fac => {
                                    if(fac.id === j.tid) {
                                        if(j.task === 'feed') return {...fac, feed: Math.min(100, fac.feed+50)};
                                        if(j.task === 'water') return {...fac, water: Math.min(100, fac.water+100)};
                                        if(j.task === 'straw') return {...fac, straw: Math.min(100, fac.straw+50)};
                                        if(j.task === 'sell') { jobMoney += fac.output * 20; return {...fac, output: 0}; }
                                    }
                                    return fac;
                                });
                            }
                        });

                        if(Math.random() > 0.1) { 
                            facilities = facilities.map(f => {
                                if(!f.animals) return f;
                                const def = ANIMALS[f.animals.type];
                                const c = f.animals.count;
                                let feed = Math.max(0, f.feed - 0.05); 
                                let water = Math.max(0, f.water - 0.08); 
                                let straw = Math.max(0, f.straw - 0.02);
                                let out = f.output;
                                if(feed > 0 && water > 0) out += (def.productRate ? def.productRate*c*0.001 : 0);
                                return {...f, feed, water, straw, output: out};
                            });
                        }

                        if(jobMoney > 0) transactions = [{id: Date.now(), desc: 'Income', amount: jobMoney, date: ct}, ...transactions].slice(0, 50);

                        return { ...prev, money: money+jobMoney, loan, fields, facilities, activeJobs: jobs, construction: pendingConst, employees, deliveries: pendingDel, inventory, consumables, lastPayroll, transactions, weather, snowLevel };
                    });
                }, 1000);
                return () => clearInterval(t);
            }, []);

            useEffect(() => { localStorage.setItem('jersey_roots_v22_6_STABLE', JSON.stringify(gameState)); }, [gameState]);

            const getEq = (id) => EQUIPMENT.find(e => e.id === id);
            const isBusy = (uid) => (gameState.activeJobs||[]).some(j => j.res.includes(uid));
            
            const getStorageStats = () => {
                let cropUsed = 0; Object.keys(CROPS).forEach(k => cropUsed += (gameState.consumables[k.toLowerCase()]||0));
                let grainCap = 0, machineCap = 0, fuelCap = 0;
                (gameState.facilities||[]).forEach(f => {
                    const def = BUILDINGS[f.key];
                    if(def.category === 'Storage') { if(def.type === 'Silo') grainCap += def.capacity; else machineCap += def.capacity; }
                    if(def.category === 'Infrastructure') fuelCap += def.capacity;
                });
                if(grainCap === 0) grainCap = 5000; if(fuelCap === 0) fuelCap = 100;
                return { cropUsed, grainCap, machineCap, machineUsed: (gameState.inventory||[]).length, fuelCap };
            };

            const getHRRequirements = () => {
                let acres = 0; (gameState.fields||[]).filter(f=>f.owned).forEach(f => acres += f.acres);
                let animalCount = 0; (gameState.facilities||[]).forEach(f => { if(f.animals) animalCount += f.animals.count; });
                let fleet = (gameState.inventory||[]).length;
                return { 'Hand': Math.max(1, Math.ceil(acres / 300)), 'Herd': animalCount > 0 ? Math.ceil(animalCount / 50) : 0, 'Mech': Math.max(0, Math.ceil(fleet / 10)), 'Vet': animalCount > 0 ? 1 : 0 };
            };

            const startJob = (d) => {
                const { type, tid, tr, imp, emp, dur, step, task } = d;
                const tractor = gameState.inventory.find(i => i.uid === tr);
                if(tractor && tractor.fuel < 10) return alert("Low Fuel!");
                if(tractor && (tractor.condition||100) <= 0) return alert("Tractor Broken!");
                const implement = gameState.inventory.find(i => i.uid === imp);
                if(implement && (implement.condition||100) <= 0) return alert("Implement Broken!");

                let finalDur = 10000;
                if(type === 'field') {
                    const f = gameState.fields.find(fd => fd.id === tid);
                    let rate = 20; 
                    if(step.includes('Tillage')) rate = 12; else if(step === 'Plant') rate = 24; else if(step === 'Harvest') rate = 16; else if(step === 'Spray') rate = 90; else rate = 60;
                    finalDur = (f.acres / rate) * HOUR_MS; 
                } else if(type === 'chore') finalDur = 1800000; 
                else if(type === 'maintenance') finalDur = 3600000;
                else if(type === 'snow') finalDur = SNOW_JOB_TIME;

                setGameState(prev => ({
                    ...prev, 
                    money: type === 'maintenance' ? prev.money - (step === 'Repair' ? REPAIR_COST : SERVICE_COST) : prev.money,
                    transactions: type === 'maintenance' ? [{id:Date.now(), desc:`Maint (${step})`, amount: -(step === 'Repair' ? REPAIR_COST : SERVICE_COST), date:Date.now()}, ...prev.transactions].slice(0,50) : prev.transactions,
                    employees: prev.employees.map(e => e.id == emp ? {...e, status:'Working'} : e),
                    inventory: prev.inventory.map(i => i.uid === tr ? {...i, fuel: Math.max(0, i.fuel - 20)} : i),
                    activeJobs: [...prev.activeJobs, { id: Math.random(), type, tid, step, emp, task, start: Date.now(), dur: finalDur, res: [tr, imp].filter(Boolean) }]
                }));
                setModal(null);
            };

            const refillTractor = (uid) => {
                const tr = gameState.inventory.find(i => i.uid === uid);
                const needed = 100 - tr.fuel;
                if(gameState.consumables.diesel < 10) return alert("Fuel Depot Empty!");
                const amount = Math.min(needed, gameState.consumables.diesel);
                setGameState(prev => ({ ...prev, consumables: {...prev.consumables, diesel: prev.consumables.diesel - amount}, inventory: prev.inventory.map(i => i.uid === uid ? {...i, fuel: i.fuel + amount} : i) }));
            };

            const buy = (item, type, qty=1) => {
                const cost = type === 'eq' ? item.cost + 1200 : item.val * qty; 
                if(gameState.money < cost) return alert("No Funds");
                let wait = DAY_MS; if(type === 'eq') wait = 5*DAY_MS; if(item.key === 'diesel') wait = 2*DAY_MS; 
                setGameState(prev => ({ ...prev, money: prev.money - cost, transactions: [{id:Date.now(), desc: `Bought ${item.name||item.key}`, amount: -cost, date: Date.now()}, ...prev.transactions].slice(0,50), deliveries: [...prev.deliveries, { id: item.id||item.key, name: item.name||item.key, type, qty, at: Date.now() + wait }] }));
            };

            const buyBundle = (type) => {
                let cost = 0;
                if(type === 'start') cost = 1500000;
                if(type === 'mega') cost = 1800000;
                if(type === 'ultimate') { if(gameState.money < 2000000) return alert("Need $2M capital"); cost = gameState.money - 5000; } 
                else if(gameState.money < cost) return alert("No Funds");
                
                let newInv = [], newFacs = [];
                if(type === 'ultimate') {
                    newInv = EQUIPMENT.map(e => ({ uid: Math.random().toString(36), itemId: e.id, fuel:100, hours:0, condition:100, lastService:0 }));
                    newFacs = [{ id: Math.random(), key: 'barn', type: 'Livestock_Dairy', category: 'Livestock', animals: { type: 'cow', count: 2 }, feed:50, water:50, straw:50, manure:0, output:0 }, { id: Math.random(), key: 'coop', type: 'Livestock_Poultry', category: 'Livestock', animals: { type: 'hen', count: 10 }, feed:50, water:50, straw:0, manure:0, output:0 }];
                } else if (type === 'start') {
                    newInv = ['cih_mag','cih_rip','jd_plnt','jd_x9','hd_corn'].map(id => ({ uid: Math.random().toString(36), itemId: id, fuel:100, hours:0, condition:100, lastService:0 }));
                } else if (type === 'mega') {
                    newInv = ['cih_mag','cih_rip','jd_plnt','tank'].map(id => ({ uid: Math.random().toString(36), itemId: id, fuel:100, hours:0, condition:100, lastService:0 }));
                    newFacs = [{ id: Math.random(), key: 'coop', type: 'Livestock_Poultry', category: 'Livestock', animals: { type: 'hen', count: 10 }, feed:50, water:50, straw:0, manure:0, output:0 }];
                }

                setGameState(prev => ({
                    ...prev, 
                    money: type === 'ultimate' ? 5000 : prev.money - cost, 
                    inventory: [...prev.inventory, ...newInv], 
                    facilities: [...prev.facilities, ...newFacs],
                    transactions: [{id:Date.now(), desc:`Bundle: ${type}`, amount:-cost, date:Date.now()}, ...prev.transactions]
                }));
                alert("Bundle Purchased!");
            };

            const buyField = (fid) => {
                const f = gameState.fields.find(f => f.id === fid);
                const cost = f.acres * LAND_PRICE_PER_ACRE;
                if(gameState.money < cost) return alert("No Funds");
                setGameState(prev => ({...prev, money: prev.money - cost, transactions: [{id:Date.now(), desc:`Land #${fid}`, amount:-cost, date:Date.now()}, ...prev.transactions], fields: prev.fields.map(fd => fd.id === fid ? {...fd, owned: true} : fd)}));
            };

            const hire = (role) => {
                const name = EMP_NAMES[Math.floor(Math.random()*EMP_NAMES.length)];
                setGameState(p => ({...p, employees: [...p.employees, {id:Date.now(), name, role, hourlyRate: EMP_ROLES[role].wage, status:'Idle'}]}));
            };

            const fireEmployee = (id) => setGameState(p => ({ ...p, employees: p.employees.filter(e => e.id !== id) }));

            const loanOp = (amt) => {
                 if(amt < 0 && gameState.money < Math.abs(amt)) return alert("No Funds");
                 setGameState(p => ({...p, money: p.money + amt, loan: p.loan + amt, transactions: [{id:Date.now(), desc: amt>0?'Loan':'Repay', amount:amt, date:Date.now()}, ...p.transactions]}));
            };

            const buyAnim = (fid, k, n) => {
                const cost = ANIMALS[k].cost * n;
                if(gameState.money < cost) return alert("No Funds");
                setGameState(prev => ({ ...prev, money: prev.money - cost, transactions: [{id:Date.now(), desc: `Bought ${n} ${ANIMALS[k].name}`, amount: -cost, date: Date.now()}, ...prev.transactions].slice(0,50), deliveries: [...prev.deliveries, { type: 'anim', id: k, name: `Live ${ANIMALS[k].name}s`, qty: n, at: Date.now() + 3*DAY_MS, targetId: fid }] }));
                setModal(null);
                alert("Animals Ordered.");
            };

            const exportSave = () => { navigator.clipboard.writeText(JSON.stringify(gameState)); alert("Save data copied!"); };
            const importSave = () => { const d = prompt("Paste save data:"); if(d) { try { JSON.parse(d); localStorage.setItem('jersey_roots_v22_6_STABLE', d); window.location.reload(); } catch(e) { alert("Invalid Data"); } } };

            const renderDash = () => (
                <div className={`space-y-6 ${gameState.snowLevel>0?'snow-bg':''} ${gameState.weather==='Rain'?'rain-bg':''}`}>
                    <div className="flex justify-between items-end border-b border-white/10 pb-4">
                        <div>
                            <h2 className="text-3xl font-black text-white flex items-center gap-2"><Icons.Clock className="w-8 h-8 text-blue-500" /> {new Date(now).toLocaleTimeString()}</h2>
                            <div className="text-slate-400 font-mono text-lg flex items-center gap-2">{new Date(now).toLocaleDateString()} <span className="text-xs bg-slate-800 px-2 py-1 rounded text-blue-300">NJ: {gameState.weather}</span></div>
                        </div>
                        <div className="text-right">
                             <div className="text-xs text-red-400">LOAN: ${Math.floor(gameState.loan).toLocaleString()}</div>
                             <button onClick={exportSave} className="text-[10px] text-blue-500 underline">Cloud Save Code</button>
                        </div>
                    </div>
                    {gameState.snowLevel > 0 && (
                        <div className="bg-blue-900/80 p-4 rounded flex justify-between items-center border border-blue-500 shadow-lg">
                            <div className="text-blue-200"><div className="font-bold flex items-center gap-2"><Icons.Snow className="w-5 h-5"/> Snow Accumulation: {Math.floor(gameState.snowLevel)}%</div><div className="text-xs">Operations slowed.</div></div>
                            <button onClick={()=>setModal({type:'chore', job:'snow'})} className="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold border border-blue-400">Plow Snow</button>
                        </div>
                    )}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        {(gameState.fields||[]).filter(f => f.owned).map(f => {
                            const job = (gameState.activeJobs||[]).find(j=>j.tid===f.id);
                            const pct = job ? Math.min(100, ((now - job.start)/job.dur)*100) : 0;
                            let timeStr = ""; if(job) { const el = now - job.start; const rem = Math.max(0, job.dur - el); timeStr = formatTime(rem); }
                            return <div key={f.id} onClick={()=>!job && setModal({type:'field', id:f.id})} className="glass-panel p-4 rounded cursor-pointer hover:bg-slate-800"><div className="font-bold text-white">#{f.id} <span className="text-xs font-normal text-slate-400">{f.state}</span></div><div className="text-xs text-slate-500">{f.acres}ac</div>{job ? <div className="mt-2"><div className="flex justify-between text-[10px] text-amber-500 font-bold mb-1"><span>{job.step}</span><span className="font-mono">{timeStr}</span></div><div className="w-full h-1 bg-slate-700 rounded"><div className="h-full bg-amber-500" style={{width:`${pct}%`}}></div></div></div> : <div className="text-[10px] text-slate-500">Idle</div>}</div>
                        })}
                    </div>
                    {/* Re-added pending deliveries/construction renderers if needed, keeping it minimal to prevent length crash */}
                </div>
            );

            // Renderers for Store, Garage, Bank, HR, RealEstate are standard, ensuring safe array access with (array || []).map
            const renderStore = () => (
                <div className="space-y-4">
                    <div className="flex gap-2"><button onClick={()=>setStoreTab('eq')} className="btn-blue px-4 py-2 rounded text-white text-xs">Equipment</button><button onClick={()=>setStoreTab('sup')} className="btn-blue px-4 py-2 rounded text-white text-xs">Supplies</button><button onClick={()=>setStoreTab('bundle')} className="btn-blue px-4 py-2 rounded text-white text-xs">Bundles</button></div>
                    {storeTab==='eq' && <div className="grid grid-cols-2 gap-2 h-96 overflow-y-auto">{EQUIPMENT.map(e=><div key={e.id} className="glass-panel p-2 flex justify-between items-center"><span className="text-white text-xs">{e.name}</span><button onClick={()=>buy(e,'eq')} className="text-green-400 text-xs">${e.cost.toLocaleString()}</button></div>)}</div>}
                    {storeTab==='sup' && <div className="grid grid-cols-3 gap-2">{Object.entries(SUPPLIES).map(([k,v])=><div key={k} className="glass-panel p-2"><div className="text-white text-xs uppercase">{k}</div><button onClick={()=>buy({key:k,val:v},'sup',10)} className="text-green-400 text-xs">+10 (${v*10})</button></div>)}</div>}
                    {storeTab==='bundle' && <div className="grid grid-cols-1 gap-4"><div className="glass-panel p-6 border border-amber-500"><h3 className="text-xl text-amber-500 font-bold">Starter Kit</h3><button onClick={()=>buyBundle('start')} className="w-full mt-2 bg-amber-700 py-2 rounded text-white">Buy $1.5M</button></div><div className="glass-panel p-6 border border-purple-500"><h3 className="text-xl text-purple-400 font-bold">Mega Bundle</h3><button onClick={()=>buyBundle('mega')} className="w-full mt-2 bg-purple-700 py-2 rounded text-white">Buy $1.8M</button></div><div className="glass-panel p-6 border border-yellow-500"><h3 className="text-xl text-yellow-400 font-bold">Ultimate Tycoon</h3><button onClick={()=>buyBundle('ultimate')} className="w-full mt-2 bg-yellow-700 py-2 rounded text-white">Liquidate & Buy</button></div></div>}
                </div>
            );

            const renderGarage = () => {
                const stats = getStorageStats();
                const items = (gameState.inventory||[]).filter(i => i.hours !== undefined);
                return <div className="space-y-6"><div className="glass-panel p-4 rounded-xl border-l-4 border-orange-500 relative overflow-hidden mb-4"><div className="flex justify-between items-start"><div><div className="text-xs text-orange-400 uppercase font-bold flex items-center gap-2"><Icons.Fuel className="w-4 h-4"/> Farm Fuel Depot</div><div className="text-2xl text-white font-mono mt-1">{Math.floor(gameState.consumables.diesel||0).toLocaleString()} <span className="text-sm text-slate-400">/ {stats.fuelCap.toLocaleString()} gal</span></div></div><button onClick={()=>setView('store')} className="bg-orange-700 hover:bg-orange-600 text-white text-xs py-2 px-3 rounded font-bold">Buy Fuel</button></div><div className="w-full h-2 bg-slate-800 mt-2 rounded overflow-hidden"><div className="h-full bg-orange-600 fuel-flow" style={{width: `${Math.min(100, ((gameState.consumables.diesel||0)/stats.fuelCap)*100)}%`}}></div></div></div><div className="grid grid-cols-2 gap-4">{items.map(i => <div key={i.uid} className="glass-panel p-4"><div className="text-white font-bold text-sm">{getEq(i.itemId).name}</div><div className="text-xs text-slate-400">Cond: {Math.floor(i.condition)}%</div><div className="w-full h-1 bg-slate-700 mt-1"><div className={`h-full ${i.condition<20?'bg-red-500':'bg-green-500'}`} style={{width:`${i.condition}%`}}></div></div><div className="flex gap-1 mt-2"><button onClick={()=>startJob({type:'maintenance', step:'Service', tid:i.uid, tr:i.uid})} className="bg-yellow-700 text-[10px] px-2 rounded text-white">Svc</button><button onClick={()=>refillTractor(i.uid)} className="bg-blue-800 text-[10px] px-2 rounded text-white">Gas</button></div></div>)}</div></div>
            };

            const renderBank = () => <div className="space-y-6"><div className="grid grid-cols-2 gap-4"><div className="glass-panel p-4 border-l-4 border-green-500"><div>Cash</div><div className="text-xl font-mono text-white">${Math.floor(gameState.money).toLocaleString()}</div></div><div className="glass-panel p-4 border-l-4 border-red-500"><div>Debt</div><div className="text-xl font-mono text-white">${Math.floor(gameState.loan).toLocaleString()}</div></div></div><div className="glass-panel p-4"><h3 className="text-white mb-2">Transactions</h3><div className="h-64 overflow-y-auto text-xs text-slate-300">{(gameState.transactions||[]).map(t=><div key={t.id} className="flex justify-between border-b border-white/10 py-1"><span>{t.desc}</span><span className={t.amount>0?'text-green-400':'text-red-400'}>${Math.floor(t.amount).toLocaleString()}</span></div>)}</div></div><div className="flex gap-2"><button onClick={()=>loanOp(50000)} className="bg-green-700 text-white px-4 py-2 rounded">Borrow 50k</button><button onClick={()=>loanOp(-50000)} className="bg-blue-700 text-white px-4 py-2 rounded">Pay 50k</button></div></div>;
            
            const renderHR = () => <div className="glass-panel p-6"><h2 className="text-2xl font-bold text-white mb-4">Staff</h2><div className="grid grid-cols-4 gap-2 mb-4">{Object.keys(EMP_ROLES).map(r => <button key={r} onClick={()=>hire(r)} className="bg-blue-600 text-white text-xs py-2 rounded">Hire {EMP_ROLES[r].name}</button>)}</div>{(gameState.employees||[]).map(e => <div key={e.id} className="text-white text-sm border-b border-white/10 py-2 flex justify-between"><span>{e.name} ({e.role})</span><span className="font-mono">${e.hourlyRate}/hr</span>{e.id!==1&&<button onClick={()=>fireEmployee(e.id)} className="text-red-500 text-xs">Fire</button>}</div>)}</div>;
            
            const renderLive = () => {
                const facilities = (gameState.facilities||[]).filter(f => BUILDINGS[f.key].category === 'Livestock');
                return <div className="space-y-6"><div className="flex justify-between"><h2 className="text-2xl font-bold text-white">Livestock</h2><button onClick={()=>setModal({type:'build', tab:'live'})} className="btn-blue px-3 py-1 rounded text-white text-xs">+ Build</button></div><div className="grid grid-cols-1 md:grid-cols-3 gap-4">{facilities.map(f => {
                    const busy = (gameState.activeJobs||[]).find(j=>j.tid == f.id);
                    return <div key={f.id} className={`glass-panel p-4 rounded border-t-4 ${f.feed<20?'border-red-500':'border-slate-600'}`}><div className="font-bold text-white mb-2">{BUILDINGS[f.key].name}</div><div className="text-xs text-slate-400 mb-2">{f.animals ? `${f.animals.count} ${ANIMALS[f.animals.type].name}` : 'Empty'}</div>{f.animals && !busy && <div className="grid grid-cols-3 gap-1"><button onClick={()=>setModal({type:'chore', job:'feed', fid:f.id})} className="bg-green-800 text-[10px] text-white rounded">Feed</button><button onClick={()=>setModal({type:'chore', job:'water', fid:f.id})} className="bg-blue-800 text-[10px] text-white rounded">Water</button></div>}{busy && <div className="text-xs text-amber-500 animate-pulse">Working...</div>}</div>})}</div></div>
            };
            
            const renderReal = () => <div className="grid grid-cols-2 md:grid-cols-4 gap-4">{(gameState.fields||[]).map(f => <div key={f.id} className={`p-4 border rounded-xl ${f.owned ? 'border-green-500/30 bg-green-900/10' : 'border-white/10'}`}><div className="flex justify-between"><span className="font-bold text-white">#{f.id}</span>{f.owned && <span className="text-[10px] text-green-500 font-bold">OWNED</span>}</div><div className="text-xs text-slate-400 mt-1">{f.acres} Acres</div>{!f.owned && <button onClick={()=>buyField(f.id)} className="w-full mt-4 py-1 bg-slate-800 text-xs font-bold text-white rounded hover:bg-slate-700">Buy ${(f.acres*LAND_PRICE_PER_ACRE).toLocaleString()}</button>}</div>)}</div>;

            return (
                <div className="min-h-screen pb-12 max-w-[1600px] mx-auto">
                    <nav className="h-16 border-b border-white/10 flex items-center justify-between px-6 bg-[#0f172a]/90 backdrop-blur sticky top-0 z-40">
                        <div className="flex items-center gap-2"><Icons.Tractor className="w-6 h-6 text-white"/><span className="font-black text-white text-lg">Jersey Roots</span></div>
                        <div className="font-mono text-white text-sm bg-slate-800 px-3 py-1 rounded">${gameState.money.toLocaleString()}</div>
                    </nav>
                    <div className="flex flex-col md:flex-row min-h-[calc(100vh-64px)]">
                        <div className="w-full md:w-64 bg-[#0f172a] border-r border-white/5 p-4 flex md:flex-col gap-2 overflow-x-auto">
                            {['Dashboard', 'Livestock', 'Store', 'Garage', 'Bank', 'HR', 'Real Estate'].map(v => 
                                <button key={v} onClick={() => setView(v.toLowerCase().replace(' ',''))} className={`px-4 py-3 rounded-xl text-left font-bold text-sm whitespace-nowrap ${view === v.toLowerCase().replace(' ','') ? 'bg-slate-800 text-white' : 'text-slate-400'}`}>{v}</button>
                            )}
                            <div className="mt-auto pt-4 border-t border-white/10"><button onClick={importSave} className="text-xs text-blue-400 border border-blue-900 px-4 py-2 rounded w-full">Import Save</button></div>
                        </div>
                        <div className="flex-1 p-6">
                            {view === 'dashboard' && renderDash()}
                            {view === 'livestock' && renderLive()}
                            {view === 'store' && renderStore()}
                            {view === 'garage' && renderGarage()}
                            {view === 'bank' && renderBank()}
                            {view === 'hr' && renderHR()}
                            {view === 'realestate' && renderReal()}
                        </div>
                    </div>
                    {renderModalContent()}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
